<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Garment Details</title>
  <link rel="stylesheet" href="./Styles/nav.css"/>
  <link rel="stylesheet" href="./Styles/garmentDetails.css" />
</head>
<body>
  <header>
    <!-- this exactly matches index.html’s nav markup -->
    <nav class="navbar">
      <a href="index.html">Home</a>
      <a href="shop.html">Shop</a>
      <a href="contact.html" class="active">Contact Us</a>
      <a id="loginButton" href="login.html">Log In</a>
    </nav>
    <script src="./javaScript/authCheck.js" defer></script>
  </header>

  <main>
    <div id="garmentContainer" class="detail-container">
      Loading garment…
    </div>
  </main>

  <!-- Sirv viewer -->
  <script src="https://scripts.sirv.com/sirvjs/v3/sirv.js"></script>

  <script>
    (async()=>{
      // get NFC tag from query
      const params = new URLSearchParams(location.search);
      const tag = params.get("nfcTagId");
      if (!tag) {
        return document.getElementById("garmentContainer").innerText = "No ID provided.";
      }

      // fetch detail from secure endpoint
      const res = await fetch(`/.netlify/functions/getGarmentByNfc?nfcTagId=${encodeURIComponent(tag)}`, {
        credentials: "include"
      });
      if (!res.ok) {
        // handle 401 / 403 / 404 as before…
        let msg = res.status === 401
          ? "Please log in."
          : res.status === 403
            ? "You don’t own this."
            : "Not found.";
        return document.getElementById("garmentContainer").innerText = msg;
      }
      const g = await res.json();

      // build the HTML
      const html = `
        <h1>${g.garmentName}</h1>

        <!-- Sirv spin -->
        <div class="Sirv"
             data-src="${g.spinUrl /* assume you saved this via metafield */}">
        </div>

        <section class="details">
          <h2>Fabric</h2>
          <ul>
            <li><strong>Type:</strong> ${g.fabricType || "—"}</li>
            <li><strong>GSM:</strong> ${g.fabricGSM || "—"}</li>
            <li><strong>Color:</strong> ${g.fabricColorName || g.fabricColorHex || "—"}</li>
            <li><strong>Source:</strong> ${g.fabricSource || "—"}</li>
          </ul>

          <h2>Thread</h2>
          <ul>
            <li><strong>Type:</strong> ${g.threadType || "—"}</li>
            <li><strong>Weight:</strong> ${g.threadWeight || "—"}</li>
            <li><strong>Material:</strong> ${g.threadMaterial || "—"}</li>
            <li><strong>Color:</strong> ${g.threadColorName || g.threadColorHex || "—"}</li>
            <li><strong>Source:</strong> ${g.threadSource || "—"}</li>
          </ul>

          <h2>Purchase Info</h2>
          <ul>
            <li><strong>Purchased by:</strong> ${g.owner}</li>
            <li><strong>Quantity:</strong> ${g.quantity}</li>
            <li><strong>Price:</strong> $${g.price}</li>
            <li><strong>First Opened:</strong> ${new Date(g.createdAt).toLocaleDateString()}</li>
            <li><strong>Last Updated:</strong> ${new Date(g.updatedAt).toLocaleString()}</li>
          </ul>
        </section>
      `;
      document.getElementById("garmentContainer").innerHTML = html;

    })();
  </script>
</body>
</html>
